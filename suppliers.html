<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Suppliers</title>
    <link rel="stylesheet" href="assets/css/style.css">
</head>
<body>
<header>
    <div class="header-left">
        <h1 data-i18n="suppliers">Suppliers</h1>
    </div>
    <div class="header-right">
        <button id="dashboard-btn" class="cta" data-i18n="dashboard">Dashboard</button>
        <div class="logout-group">
            <div class="language-selector">
                <button class="language-globe-btn" title="Change language">üåê</button>
                <div class="language-dropdown">
                    <button data-lang="en">English</button>
                    <button data-lang="sv">Svenska</button>
                    <button data-lang="no">Norsk</button>
                    <button data-lang="da">Dansk</button>
                    <button data-lang="fr">Fran√ßais</button>
                    <button data-lang="es">Espa√±ol</button>
                    <button data-lang="de">Deutsch</button>
                    <button data-lang="it">Italiano</button>
                    <button data-lang="nl">Nederlands</button>
                    <button data-lang="pl">Polski</button>
                </div>
            </div>
            <button id="logout-btn" class="logout-btn" data-i18n="logout">Logout</button>
            <label class="theme-toggle">
                <input type="checkbox" id="theme-switch">
                <span class="slider"></span>
            </label>
        </div>
    </div>
    <div class="hamburger" id="hamburger">
        <span></span>
        <span></span>
        <span></span>
    </div>
</header>

<div class="main">
    <div class="card">
        <h2 data-i18n="select_supplier">Select Supplier</h2>
        <div id="suppliers-list">
            <!-- Suppliers will be loaded here -->
        </div>
        <button id="add-supplier-btn" class="cta" style="margin-top:24px;" data-i18n="add_new_supplier">Add New Supplier</button>
    </div>
</div>

<script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
<script src="assets/js/i18n.js"></script>
<script>
const supabase = window.supabase.createClient('https://qxpaplabjocxaftqocgu.supabase.co', 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InF4cGFwbGFiam9jeGFmdHFvY2d1Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjU2NTcyOTQsImV4cCI6MjA4MTIzMzI5NH0.VpoV9d2XGkRTv5UoZFKiA23IOOV2zasV18pW_9JmCj4');

document.addEventListener('DOMContentLoaded', async () => {
    applyTranslations();

    const { data: { session } } = await supabase.auth.getSession();
    if (!session) {
        window.location.href = 'index.html';
        return;
    }

    document.getElementById('dashboard-btn').addEventListener('click', () => window.location.href = 'dashboard.html');
    document.getElementById('logout-btn').addEventListener('click', async () => {
        await supabase.auth.signOut();
        window.location.href = 'index.html';
    });

    // Load suppliers
    const { data: suppliers } = await supabase
        .from('suppliers')
        .select('*')
        .eq('user_id', session.user.id);

    const list = document.getElementById('suppliers-list');
    if (suppliers && suppliers.length > 0) {
        suppliers.forEach(sup => {
            const div = document.createElement('div');
            div.className = 'metric-card';
            div.style.cursor = 'pointer';
            div.innerHTML = `<h3>${sup.name}</h3><p>${sup.org_number}</p>`;
            div.onclick = () => {
                localStorage.setItem('selected_supplier_id', sup.id);
                localStorage.setItem('selected_supplier_name', sup.name);
                window.location.href = 'dashboard.html';
            };
            list.appendChild(div);
        });
    } else {
        list.innerHTML = '<p data-i18n="no_suppliers">No suppliers found. Add one to get started.</p>';
    }

    document.getElementById('add-supplier-btn').addEventListener('click', () => {
        // Redirect to add supplier form or modal
        alert('Add supplier functionality coming soon!');
    });
});
</script>
</body>
</html>
