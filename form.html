<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>PEPPOL BIS 3.0 Invoice Generator</title>
    <link rel="stylesheet" href="assets/css/style.css">
</head>
<body>
<header>
    <div class="header-left">
        <h1 id="pageTitle">Create Invoice</h1>
        <span id="active-supplier"></span>
    </div>

    <div class="header-right">
        <button id="dashboard-btn" class="cta">‚Üê Back to Dashboard</button>
        <div class="logout-group">
            <!-- Language Selector -->
            <div class="language-selector">
                <button class="language-globe-btn" title="Change language">üåê</button>
                <div class="language-dropdown">
                    <button data-lang="en">English</button>
                    <button data-lang="sv">Svenska</button>
                    <button data-lang="no">Norsk</button>
                    <button data-lang="da">Dansk</button>
                    <button data-lang="fr">Fran√ßais</button>
                    <button data-lang="es">Espa√±ol</button>
                    <button data-lang="de">Deutsch</button>
                    <button data-lang="it">Italiano</button>
                    <button data-lang="nl">Nederlands</button>
                    <button data-lang="pl">Polski</button>
                </div>
            </div>
            <button id="logout-btn" class="logout-btn">Logout</button>
            <label class="theme-toggle">
                <input type="checkbox" id="theme-switch">
                <span class="slider"></span>
            </label>
        </div>
    </div>

    <div class="hamburger" id="hamburger">
        <span></span>
        <span></span>
        <span></span>
    </div>
</header>

<div class="mobile-nav" id="mobile-nav">
    <button class="mobile-nav-close" id="mobile-nav-close">√ó</button>
    <button id="mobile-dashboard-btn">‚Üê Back to Dashboard</button>

    <!-- Mobile language selector -->
    <div class="language-selector" style="margin: 20px 0;">
        <button class="language-globe-btn" style="font-size: 32px;">üåê</button>
        <div class="language-dropdown">
            <button data-lang="en">English</button>
            <button data-lang="sv">Svenska</button>
            <button data-lang="no">Norsk</button>
            <button data-lang="da">Dansk</button>
            <button data-lang="fr">Fran√ßais</button>
            <button data-lang="es">Espa√±ol</button>
            <button data-lang="de">Deutsch</button>
            <button data-lang="it">Italiano</button>
            <button data-lang="nl">Nederlands</button>
            <button data-lang="pl">Polski</button>
        </div>
    </div>

    <button id="mobile-logout-btn" class="logout-btn">Logout</button>
    <label class="theme-toggle" style="margin:20px 0;">
        <input type="checkbox" id="mobile-theme-switch">
        <span class="slider"></span>
    </label>
</div>

<div class="container">
    <form id="invoiceForm">
        <div class="card">
            <h2>Invoice Details</h2>
            <div class="form-grid">
                <div class="form-group">
                    <label>Invoice ID</label>
                    <input name="invoiceId" required>
                </div>
                <div class="form-group">
                    <label>Issue Date</label>
                    <input type="date" name="issueDate" required>
                </div>
                <div class="form-group">
                    <label>Due Date</label>
                    <input type="date" name="dueDate" required>
                </div>
                <div class="form-group">
                    <label>Buyer Reference</label>
                    <input name="buyerReference">
                </div>
                <div class="form-group">
                    <label>Order Reference</label>
                    <input name="orderReference">
                </div>
                <div class="form-group">
                    <label>Currency</label>
                    <select name="currency" id="currencySelect" required>
                        <option value="EUR">EUR - Euro</option>
                        <option value="USD">USD - US Dollar</option>
                        <option value="GBP">GBP - British Pound</option>
                        <option value="SEK">SEK - Swedish Krona</option>
                        <option value="NOK">NOK - Norwegian Krone</option>
                        <option value="DKK">DKK - Danish Krone</option>
                        <option value="CHF">CHF - Swiss Franc</option>
                    </select>
                </div>
                <div class="form-group">
                    <label>Invoice Note</label>
                    <textarea name="invoiceNote" rows="5"></textarea>
                </div>
            </div>
        </div>

        <div class="card">
            <h2>Supplier Info (from selected supplier)</h2>
            <div class="form-grid">
                <div class="form-group"><label>Supplier Name</label><input id="supplierName" readonly></div>
                <div class="form-group"><label>Supplier Endpoint ID</label><input id="supplierEndpoint" readonly></div>
                <div class="form-group"><label>Supplier VAT ID</label><input id="supplierVAT" readonly></div>
                <div class="form-group"><label>Supplier Street</label><input id="supplierStreet" readonly></div>
                <div class="form-group"><label>Supplier Additional Street</label><input id="supplierAdditionalStreet" readonly></div>
                <div class="form-group"><label>Supplier City</label><input id="supplierCity" readonly></div>
                <div class="form-group"><label>Supplier Postal Code</label><input id="supplierPostal" readonly></div>
                <div class="form-group"><label>Supplier Country</label><input id="supplierCountry" readonly></div>
                <div class="form-group"><label>Supplier Email</label><input id="supplierEmail" readonly></div>
            </div>
        </div>

        <div class="card">
            <h2>Customer Info</h2>
            <div class="form-group">
                <label>Select Customer *</label>
                <select id="customerSelect" required></select>
            </div>
            <div class="form-grid">
                <div class="form-group"><label>Customer Name</label><input id="customerName" readonly></div>
                <div class="form-group"><label>Customer Endpoint ID</label><input id="customerEndpoint" readonly></div>
                <div class="form-group"><label>Customer VAT ID</label><input id="customerVAT" readonly></div>
                <div class="form-group"><label>Customer Street</label><input id="customerStreet" readonly></div>
                <div class="form-group"><label>Customer Additional Street</label><input id="customerAdditionalStreet" readonly></div>
                <div class="form-group"><label>Customer City</label><input id="customerCity" readonly></div>
                <div class="form-group"><label>Customer Postal Code</label><input id="customerPostal" readonly></div>
                <div class="form-group"><label>Customer Country</label><input id="customerCountry" readonly></div>
                <div class="form-group"><label>Registration Name</label><input id="customerRegName" readonly></div>
                <div class="form-group"><label>Company ID</label><input id="customerCompanyID" readonly></div>
                <div class="form-group"><label>Contact Name</label><input id="customerContactName" readonly></div>
                <div class="form-group"><label>Contact Phone</label><input id="customerContactPhone" readonly></div>
                <div class="form-group"><label>Contact Email</label><input id="customerContactEmail" readonly></div>
            </div>
        </div>

        <div class="card">
            <h2>Payment Information</h2>
            <div class="form-grid">
                <div class="form-group">
                    <label>Select Bank Account</label>
                    <select id="paymentSelect" required></select>
                </div>
                <div class="form-group"><label>Account Name</label><input id="accountName" readonly></div>
                <div class="form-group"><label>Payment Means Code</label><select id="paymentMeansCode"></select></div>
                <div class="form-group"><label>IBAN</label><input id="iban" readonly></div>
                <div class="form-group"><label>BBAN</label><input id="bban" readonly></div>
                <div class="form-group"><label>BIC</label><input id="bic" readonly></div>
                <div class="form-group"><label>Payment ID</label><input id="paymentID"></div>
                <div class="form-group">
                    <label>Payment Terms</label>
                    <select id="paymentTermsNote">
                        <option value="">No payment terms</option>
                        <option value="Payment due upon receipt">Payment due upon receipt</option>
                        <option value="Net 10 days">Net 10 days</option>
                        <option value="Net 15 days">Net 15 days</option>
                        <option value="Net 30 days">Net 30 days</option>
                        <option value="Net 60 days">Net 60 days</option>
                        <option value="2% 10 Net 30">2% discount if paid within 10 days, otherwise net 30</option>
                        <option value="Payment in advance">Payment in advance</option>
                        <option value="End of following month">End of following month</option>
                    </select>
                </div>
            </div>
        </div>

        <div class="card">
            <h2>Allowances / Charges</h2>
            <table id="allowanceTable">
                <thead>
                    <tr>
                        <th>Charge?</th><th>Reason</th><th>Amount</th><th>Tax Code</th><th>Tax %</th><th>Actions</th>
                    </tr>
                </thead>
                <tbody></tbody>
            </table>
            <button type="button" id="addAllowanceBtn">‚ûï Add Allowance/Charge</button>
        </div>

        <div class="card">
            <h2>Invoice Lines</h2>
            <table id="linesTable">
                <thead>
                    <tr>
                        <th>Description</th><th>Item Name</th><th>Quantity</th><th>Unit Price</th><th>VAT %</th><th>Tax Code</th><th>Reverse Charge</th><th>Actions</th>
                    </tr>
                </thead>
                <tbody></tbody>
            </table>
            <button type="button" id="addLineBtn">‚ûï Add Line</button>
        </div>

        <div class="card">
            <h3>Grand Total: <span id="grandTotal">0.00</span> <span id="currencyDisplay">EUR</span></h3>
            <div class="section-actions">
                <button type="submit" id="generateBtn" class="btn btn-primary" disabled>Generate XML & Save Draft</button>
                <button type="button" id="sendInvoiceBtn" class="btn btn-success" disabled>Send Invoice</button>
                <span id="generateHint" class="generate-hint">Add at least one complete invoice line (description or item name + qty > 0 + price > 0)</span>
            </div>
        </div>
    </form>

    <div class="card">
        <h2>XML Preview</h2>
        <pre id="xmlPreview">&lt;XML will appear here&gt;</pre>
        <div id="validationResults" class="validation-results" style="display:none;">
            <h3>PEPPOL Validation Results</h3>
            <div id="validationMessages"></div>
        </div>
        <button id="downloadXMLBtn">üíæ Download XML</button>
    </div>
</div>

<script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
<script src="assets/js/i18n.js"></script>
<script src="assets/js/form.js"></script>
</body>
</html>
